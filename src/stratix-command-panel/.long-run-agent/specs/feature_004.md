# Feature feature_004 - 指令日志展示

## 元信息
- **优先级**: P1
- **负责人**: stratix-team
- **预计工时**: 3天
- **创建时间**: 2026-02-22 17:21:50

## 功能描述
展示当前 Agent 最近执行的指令记录（状态、结果、时间），支持指令历史查询和执行结果查看，实时更新指令状态。

## 功能设计方案

### 1. 日志列表展示
- **展示内容**：
  - 指令 ID（`commandId`）
  - Agent 名称（`agentName`）
  - 技能名称（`skillName`）
  - 执行状态（`status`：pending/running/success/failed）
  - 执行时间（`time`）
  - 执行结果（`result`：可选）
- **展示数量**：最近 10 条指令日志
- **排序方式**：按执行时间倒序（最新的在最上面）

### 2. 状态实时更新
- **监听事件**：`stratix:command_status_update`
- **更新机制**：
  - 接收到事件后，根据 `commandId` 查找对应日志
  - 更新日志的状态（`status`）和结果（`result`）
  - 触发 UI 重新渲染

### 3. 状态视觉设计
- **状态颜色映射**：
  - `pending`：青色（#00FFFF）- 等待执行
  - `running`：黄色（#FFFF00）- 执行中
  - `success`：绿色（#00FF00）- 执行成功
  - `failed`：红色（#FF0000）- 执行失败
- **状态图标**：
  - `pending`：⏳（沙漏）
  - `running`：⚡（闪电）
  - `success`：✓（对勾）
  - `failed`：✗（叉号）

### 4. 日志详情查看
- **触发方式**：点击日志条目
- **展示内容**：
  - 完整的指令参数（格式化 JSON）
  - 执行结果详情（如果执行成功）
  - 错误信息（如果执行失败）
  - 执行耗时（可选）
- **展示方式**：模态对话框或侧边栏

### 5. 日志筛选与搜索（可选）
- **筛选条件**：
  - 按状态筛选（仅显示成功/失败的指令）
  - 按技能筛选（仅显示特定技能的指令）
  - 按时间范围筛选（今天/最近 7 天/最近 30 天）
- **搜索功能**：
  - 支持按指令 ID 搜索
  - 支持按 Agent 名称搜索
  - 支持按技能名称搜索

### 6. 技术实现
**文件结构**：
```
src/stratix-command-panel/
├── components/
│   └── CommandLog.vue         # 指令日志组件
└── StratixCommandPanel.ts     # 核心逻辑类
```

**核心接口**：
- 订阅事件：`stratix:command_status_update`
- 暴露方法：`addLog(log)`, `updateLogStatus(commandId, status, result, error)`

**依赖**：
- Vue 3 Composition API
- StratixEventBus

## 开发步骤
- [ ] 步骤 1：创建 CommandLog.vue 组件基础结构，实现日志列表渲染
- [ ] 步骤 2：实现日志添加逻辑（接收新指令日志）
- [ ] 步骤 3：实现日志状态更新逻辑（订阅 command_status_update 事件）
- [ ] 步骤 4：实现日志详情查看功能（模态对话框）
- [ ] 步骤 5：实现日志筛选和搜索功能
- [ ] 步骤 6：编写样式（状态颜色、图标、布局）
- [ ] 步骤 7：集成到 StratixCommandPanel.ts 核心类
- [ ] 步骤 8：编写单元测试

## 测试用例
| 用例编号 | 场景 | 操作步骤 | 预期结果 |
|----------|------|----------|----------|
| TC-001 | 日志添加测试 | 提交一个新指令 | 日志列表顶部新增一条日志，状态为 `pending`，显示技能名称和 Agent 名称 |
| TC-002 | 状态更新测试 | 接收到 `stratix:command_status_update` 事件 | 对应日志的状态更新，显示执行结果或错误信息，状态颜色正确 |
| TC-003 | 日志筛选测试 | 选择状态筛选为"执行成功" | 仅显示状态为 `success` 的日志 |
| TC-004 | 日志搜索测试 | 在搜索框输入"文案" | 仅显示技能名称或 Agent 名称包含"文案"的日志 |
| TC-005 | 日志详情查看测试 | 点击日志条目 | 弹出模态对话框，显示完整的指令参数和执行结果 |

## 验收标准
- [ ] 正确展示指令执行日志（最多 10 条）
- [ ] 日志状态实时更新，状态颜色和图标正确显示
- [ ] 支持日志筛选和搜索功能
- [ ] 点击日志可查看详情（模态对话框）
- [ ] 日志列表按时间倒序排列
- [ ] UI 样式符合 Stratix 设计规范（颜色、图标、布局）
- [ ] 代码通过 ESLint 检查，无类型错误

## 变更记录
| 日期 | 变更内容 | 变更人 |
|------|----------|--------|
| 2026-02-22 | 初始创建 | AI Assistant |
| 2026-02-22 | 迁移内容到 LRA 标准格式 | AI Assistant |
